<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>JS Seam carving</title>
		<script src="seam.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css" media="screen">
			canvas{
				border: solid 1px #515151;
				margin: 20px;
				display: block;
			}
			
			#grayscale, #sobel, #energy{
				display: none;
			}
			
			#grayscale{
				display: block;
			}
		</style>
	</head>
	<body>
		
		<canvas id="refImg" width="500" height="500"></canvas>
		<canvas id="grayscale" width="500" height="500"></canvas>
		<canvas id="sobel" width="500" height="500"></canvas>
		<canvas id="energy" width="500" height="500"></canvas>
		<canvas id="seamcanvas" width="500" height="500"></canvas>
		
		<script type="text/javascript" charset="utf-8">
			(function(){
								
				var $ = document.querySelectorAll;
				document.addEventListener('DOMContentLoaded', function(){
					var orgCanvas = document.querySelector('#refImg');
					var orgCtx = orgCanvas.getContext('2d');
					
					var grayCanvas = document.querySelector('#grayscale');
					var grayCtx = grayCanvas.getContext('2d');
					
					var sobelCanvas = document.querySelector('#sobel');
					var sobelCtx = sobelCanvas.getContext('2d');
					
					var energyCanvas = document.querySelector('#energy');
					var energyCtx = energyCanvas.getContext('2d');
					
					var seamCanvas = document.querySelector('#seamcanvas');
					var seamCtx = seamcanvas.getContext('2d');
					
					var originalImage = new Image();
					
					var NB_SLICE = 4;
					
					originalImage.src = "images/dolphin.jpg";
					originalImage.addEventListener('load', function(){
						//console.profile();
						sobelCanvas.height = grayCanvas.height = energyCanvas.height = seamCanvas.height = orgCanvas.height = this.height;
						sobelCanvas.width = grayCanvas.width = energyCanvas.width = seamCanvas.width = orgCanvas.width = this.width;		
						
						seamCanvas.width = this.width + NB_SLICE;
						
						orgCtx.drawImage(this, 0,0);
						
						var imageData = orgCtx.getImageData(0,0, this.width, this.height);
						var out = seamCtx.createImageData(this.width + NB_SLICE, this.height);

						//var d = seamCtx.createImageData(this.width + (NB_SLICE > 0 ? (NB_SLICE - 1) : NB_SLICE + 1), this.height);
						var d = seamCtx.createImageData(this.width, this.height);
												
						var s = new SeamCarving(imageData, out);						
						s.resize();
						
						grayCtx.putImageData(s.debug(d, 0), 0,0);
						sobelCtx.putImageData(s.debug(d, 2), 0,0);
						energyCtx.putImageData(s.debug(d, 1), 0,0);
						seamCtx.putImageData(s.out, 0,0);
						
						//orgCanvas.style.width = this.width - NB_SLICE + "px";
						//console.profileEnd();
					});
				});
			})()
		</script>
	</body>
</html>